create table public.comentarios (
  id uuid not null default gen_random_uuid (),
  evento_id uuid null,
  usuario_id uuid null,
  conteudo text not null,
  created_at timestamp with time zone null default now(),
  constraint comentarios_pkey primary key (id),
  constraint comentarios_evento_id_fkey foreign KEY (evento_id) references eventos (id) on delete CASCADE,
  constraint comentarios_usuario_id_fkey foreign KEY (usuario_id) references usuarios (id) on delete CASCADE
) TABLESPACE pg_default;

create table public.comunidades (
  id uuid not null default gen_random_uuid (),
  nome character varying(100) not null,
  descricao text null,
  tipo character varying(50) not null,
  criador_id uuid null,
  created_at timestamp with time zone null default now(),
  constraint comunidades_pkey primary key (id),
  constraint comunidades_criador_id_fkey foreign KEY (criador_id) references usuarios (id)
) TABLESPACE pg_default;

create table public.eventos (
  id uuid not null default gen_random_uuid (),
  titulo character varying(200) not null,
  descricao text null,
  data date not null,
  hora time without time zone not null,
  local character varying(300) not null,
  categoria character varying(50) not null,
  imagem_url text null,
  organizador_id uuid null,
  created_at timestamp with time zone null default now(),
  constraint eventos_pkey primary key (id),
  constraint eventos_organizador_id_fkey foreign KEY (organizador_id) references usuarios (id)
) TABLESPACE pg_default;

create table public.membros_comunidade (
  id uuid not null default gen_random_uuid (),
  comunidade_id uuid null,
  usuario_id uuid null,
  created_at timestamp with time zone null default now(),
  constraint membros_comunidade_pkey primary key (id),
  constraint membros_comunidade_comunidade_id_usuario_id_key unique (comunidade_id, usuario_id),
  constraint membros_comunidade_comunidade_id_fkey foreign KEY (comunidade_id) references comunidades (id) on delete CASCADE,
  constraint membros_comunidade_usuario_id_fkey foreign KEY (usuario_id) references usuarios (id) on delete CASCADE
) TABLESPACE pg_default;


create table public.presencas (
  id uuid not null default gen_random_uuid (),
  evento_id uuid null,
  usuario_id uuid null,
  status character varying(20) null default 'confirmado'::character varying,
  created_at timestamp with time zone null default now(),
  constraint presencas_pkey primary key (id),
  constraint presencas_evento_id_usuario_id_key unique (evento_id, usuario_id),
  constraint presencas_evento_id_fkey foreign KEY (evento_id) references eventos (id) on delete CASCADE,
  constraint presencas_usuario_id_fkey foreign KEY (usuario_id) references usuarios (id) on delete CASCADE,
  constraint presencas_status_check check (
    (
      (status)::text = any (
        (
          array[
            'confirmado'::character varying,
            'interessado'::character varying,
            'cancelado'::character varying
          ]
        )::text[]
      )
    )
  )
) TABLESPACE pg_default;


create table public.usuarios (
  id uuid not null default gen_random_uuid (),
  nome character varying(100) not null,
  email character varying(255) not null,
  avatar text null,
  bio text null,
  created_at timestamp with time zone null default now(),
  constraint usuarios_pkey primary key (id),
  constraint usuarios_email_key unique (email)
) TABLESPACE pg_default;